<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>é›†çµã‚¿ã‚¤ãƒãƒ¼</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      background: #111827;
      min-height: 100vh;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      padding: 10px;
    }
    h1 {
      color: white;
      text-align: center;
      font-size: 1.5rem;
      margin-bottom: 15px;
    }
    .grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      max-width: 600px;
      margin: 0 auto 20px;
    }
    .player-card {
      background: #1f2937;
      border-radius: 12px;
      padding: 15px;
      text-align: center;
      border: 3px solid #374151;
      transition: all 0.3s;
    }
    .player-card.waiting {
      border-color: #f59e0b;
      background: #292524;
    }
    .player-card.go {
      border-color: #22c55e;
      background: #14532d;
      animation: pulse 0.5s ease-in-out infinite alternate;
    }
    @keyframes pulse {
      from { transform: scale(1); }
      to { transform: scale(1.02); }
    }
    .player-name {
      color: #9ca3af;
      font-size: 0.9rem;
      margin-bottom: 8px;
    }
    .time-input {
      width: 80px;
      padding: 10px;
      font-size: 1.5rem;
      text-align: center;
      border: 2px solid #4b5563;
      border-radius: 8px;
      background: #374151;
      color: white;
      margin-bottom: 10px;
    }
    .time-input:focus {
      outline: none;
      border-color: #3b82f6;
    }
    .time-label {
      color: #9ca3af;
      font-size: 0.8rem;
    }
    .countdown {
      font-size: 3rem;
      font-weight: bold;
      color: #f59e0b;
      margin: 10px 0;
    }
    .countdown.go {
      color: #22c55e;
      font-size: 2.5rem;
    }
    .status {
      color: #9ca3af;
      font-size: 0.9rem;
    }
    .controls {
      text-align: center;
      margin-bottom: 20px;
    }
    .start-btn {
      padding: 15px 40px;
      font-size: 1.3rem;
      font-weight: bold;
      color: white;
      background: #3b82f6;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.2s;
    }
    .start-btn:hover {
      background: #2563eb;
    }
    .start-btn:active {
      transform: scale(0.95);
    }
    .start-btn:disabled {
      background: #4b5563;
      cursor: not-allowed;
    }
    .reset-btn {
      padding: 10px 25px;
      font-size: 1rem;
      color: white;
      background: #ef4444;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      margin-left: 10px;
    }
    .reset-btn:hover {
      background: #dc2626;
    }
    .info {
      text-align: center;
      color: #6b7280;
      font-size: 0.85rem;
      margin-top: 15px;
    }
    .rally-select {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-bottom: 20px;
    }
    .rally-btn {
      padding: 12px 25px;
      font-size: 1.1rem;
      font-weight: bold;
      color: #9ca3af;
      background: #374151;
      border: 2px solid #4b5563;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.2s;
    }
    .rally-btn:hover {
      background: #4b5563;
    }
    .rally-btn.active {
      color: #1f2937;
      background: #eab308;
      border-color: #eab308;
    }
  </style>
</head>
<body>
  <h1 id="title">ğŸ¯ é›†çµã‚¿ã‚¤ãƒãƒ¼</h1>

  <!-- é›†çµæ™‚é–“é¸æŠ -->
  <div class="rally-select">
    <button class="rally-btn active" id="rally1" onclick="selectRally(1)">1åˆ†é›†çµ</button>
    <button class="rally-btn" id="rally5" onclick="selectRally(5)">5åˆ†é›†çµ</button>
  </div>

  <div class="grid" id="playerGrid">
    <!-- 4äººåˆ†ã®ã‚«ãƒ¼ãƒ‰ -->
  </div>

  <div class="controls">
    <button class="start-btn" id="startBtn">ğŸš€ ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³é–‹å§‹</button>
    <button class="reset-btn" id="resetBtn" style="display:none;">ãƒªã‚»ãƒƒãƒˆ</button>
  </div>

  <div class="info">
    è¡Œè»æ™‚é–“ï¼ˆç§’ï¼‰ã‚’å…¥åŠ› â†’ ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³é–‹å§‹ â†’ ã€ŒGO!ã€ã§é›†çµã‚’æ‰“ã¤ï¼
  </div>

  <script>
    const PLAYERS = ['DAIGORO', 'ãƒ¤ãƒ³ãƒ¤ãƒ³', 'ã©ã‚‰ã™ã‘', 'ã‚„ã¾'];
    
    let isRunning = false;
    let timers = [];
    let audioCtx = null;
    let selectedRally = 1; // 1åˆ† or 5åˆ†

    // é›†çµæ™‚é–“é¸æŠ
    const selectRally = (minutes) => {
      if (isRunning) return;
      selectedRally = minutes;
      document.getElementById('rally1').classList.toggle('active', minutes === 1);
      document.getElementById('rally5').classList.toggle('active', minutes === 5);
      document.getElementById('title').textContent = `ğŸ¯ ${minutes}åˆ†é›†çµã‚¿ã‚¤ãƒãƒ¼`;
    };

    // éŸ³ã‚’é³´ã‚‰ã™
    const playBeep = (frequency = 800, duration = 150) => {
      if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      const oscillator = audioCtx.createOscillator();
      const gainNode = audioCtx.createGain();
      oscillator.connect(gainNode);
      gainNode.connect(audioCtx.destination);
      oscillator.frequency.value = frequency;
      oscillator.type = 'sine';
      gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
      gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + duration / 1000);
      oscillator.start(audioCtx.currentTime);
      oscillator.stop(audioCtx.currentTime + duration / 1000);
    };

    const playGo = () => {
      playBeep(1200, 300);
      setTimeout(() => playBeep(1500, 400), 150);
    };

    // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚«ãƒ¼ãƒ‰ç”Ÿæˆ
    const renderCards = () => {
      const grid = document.getElementById('playerGrid');
      grid.innerHTML = '';
      
      PLAYERS.forEach((name, i) => {
        const card = document.createElement('div');
        card.className = 'player-card';
        card.id = `player-${i}`;
        card.innerHTML = `
          <div class="player-name">${name}</div>
          <input type="number" class="time-input" id="time-${i}" value="15" min="1" max="60">
          <div class="time-label">ç§’</div>
          <div class="countdown" id="countdown-${i}" style="display:none;">--</div>
          <div class="status" id="status-${i}">è¡Œè»æ™‚é–“ã‚’å…¥åŠ›</div>
        `;
        grid.appendChild(card);
      });
    };

    // ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³é–‹å§‹
    const startCountdown = () => {
      if (isRunning) return;
      
      // å„ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®è¡Œè»æ™‚é–“ã‚’å–å¾—
      const times = PLAYERS.map((_, i) => {
        const input = document.getElementById(`time-${i}`);
        return parseInt(input.value) || 15;
      });

      // æœ€é•·æ™‚é–“ã‚’å–å¾—
      const maxTime = Math.max(...times);

      // å„ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®å¾…æ©Ÿæ™‚é–“ã‚’è¨ˆç®—ï¼ˆæœ€åˆã®äººã‚‚10ç§’å¾…ã¤ï¼‰
      const baseWait = 10;
      const waitTimes = times.map(t => baseWait + (maxTime - t));
      const totalTime = baseWait + maxTime;

      isRunning = true;
      document.getElementById('startBtn').disabled = true;
      document.getElementById('resetBtn').style.display = 'inline-block';
      
      // é›†çµé¸æŠãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–
      document.getElementById('rally1').disabled = true;
      document.getElementById('rally5').disabled = true;

      // å…¥åŠ›æ¬„ã‚’éè¡¨ç¤ºã€ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³ã‚’è¡¨ç¤º
      PLAYERS.forEach((_, i) => {
        document.getElementById(`time-${i}`).style.display = 'none';
        document.querySelector(`#player-${i} .time-label`).style.display = 'none';
        document.getElementById(`countdown-${i}`).style.display = 'block';
        document.getElementById(`countdown-${i}`).textContent = waitTimes[i];
        document.getElementById(`status-${i}`).textContent = 'å¾…æ©Ÿä¸­...';
        document.getElementById(`player-${i}`).classList.add('waiting');
      });

      // ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³å®Ÿè¡Œ
      let elapsed = 0;
      const interval = setInterval(() => {
        elapsed++;
        
        PLAYERS.forEach((_, i) => {
          const remaining = waitTimes[i] - elapsed;
          const countdownEl = document.getElementById(`countdown-${i}`);
          const statusEl = document.getElementById(`status-${i}`);
          const cardEl = document.getElementById(`player-${i}`);

          if (remaining > 0) {
            countdownEl.textContent = remaining;
            countdownEl.className = 'countdown';
            // ãƒ©ã‚¹ãƒˆ3ç§’ã§ãƒ“ãƒ¼ãƒ—éŸ³
            if (remaining <= 3) {
              playBeep(600 + (3 - remaining) * 200, 100);
            }
          } else if (remaining === 0) {
            countdownEl.textContent = 'GO!';
            countdownEl.className = 'countdown go';
            statusEl.textContent = 'ä»Šã™ãé›†çµï¼';
            cardEl.classList.remove('waiting');
            cardEl.classList.add('go');
            playGo();
          }
        });

        // å…¨å“¡GOã—ãŸã‚‰å°‘ã—å¾…ã£ã¦åœæ­¢
        const allDone = waitTimes.every(w => elapsed >= w);
        if (allDone && elapsed >= totalTime + 3) {
          clearInterval(interval);
        }
      }, 1000);

      timers.push(interval);
    };

    // ãƒªã‚»ãƒƒãƒˆ
    const reset = () => {
      isRunning = false;
      timers.forEach(t => clearInterval(t));
      timers = [];
      
      document.getElementById('startBtn').disabled = false;
      document.getElementById('resetBtn').style.display = 'none';
      
      // é›†çµé¸æŠãƒœã‚¿ãƒ³ã‚’æœ‰åŠ¹åŒ–
      document.getElementById('rally1').disabled = false;
      document.getElementById('rally5').disabled = false;

      PLAYERS.forEach((_, i) => {
        document.getElementById(`time-${i}`).style.display = 'block';
        document.querySelector(`#player-${i} .time-label`).style.display = 'block';
        document.getElementById(`countdown-${i}`).style.display = 'none';
        document.getElementById(`status-${i}`).textContent = 'è¡Œè»æ™‚é–“ã‚’å…¥åŠ›';
        document.getElementById(`player-${i}`).classList.remove('waiting', 'go');
      });
    };

    // åˆæœŸåŒ–
    renderCards();
    document.getElementById('startBtn').onclick = startCountdown;
    document.getElementById('resetBtn').onclick = reset;
    document.getElementById('title').textContent = 'ğŸ¯ 1åˆ†é›†çµã‚¿ã‚¤ãƒãƒ¼';
  </script>
</body>
</html>
